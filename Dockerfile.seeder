FROM node:16

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

# Add wait-for-it script to wait for PostgreSQL to be ready
ADD https://raw.githubusercontent.com/vishnubob/wait-for-it/master/wait-for-it.sh /usr/local/bin/wait-for-it
RUN chmod +x /usr/local/bin/wait-for-it

# Run both seed scripts in sequence
CMD ["sh", "-c", "wait-for-it postgres:5432 -t 60 -- node scripts/seedDatabase.js && node scripts/seedUniversities.js"]
